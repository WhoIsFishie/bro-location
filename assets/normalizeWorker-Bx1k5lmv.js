(function(){"use strict";function f(t,e){const s=e.replace(/\(UTC.*\)$/i,""),[n,r,i]=t.split(/[/-]/).map(a=>parseInt(a,10));if(!Number.isFinite(n)||!Number.isFinite(r)||!Number.isFinite(i))return null;const o=n>12,m=o?n:r,c=(o?r:n)-1,l=i<100?2e3+i:i,[u,p,d]=s.split(":").map(a=>parseInt(a,10));if(![u,p,d].every(a=>Number.isFinite(a)))return null;const y=Date.UTC(l,c,m,u,p,d);return Number.isFinite(y)?y:null}function g(t){const e=Number(t?.location_data?.latitude),s=Number(t?.location_data?.longitude);if(!Number.isFinite(e)||!Number.isFinite(s))return null;const n=(t?.party?.name??"").toString(),r=(t?.party?.phone??"").toString(),i=(t?.party?.direction??"").toString(),o=(t?.message??"").toString(),m=t?.timestamp?.date??"",c=(t?.timestamp?.time??"").replace(/\(UTC.*\)$/i,""),l=f(m,c),u=`${n} ${r} ${o}`.toLowerCase();return{id:Number(t.id),type:t.type,timestampMs:l,originalDate:m,originalTime:c,partyName:n,partyPhone:r,partyDirection:i,message:o,latitude:e,longitude:s,searchText:u}}function N(t){const e=[];for(const s of t){const n=g(s);n&&e.push(n)}return e}self.onmessage=t=>{try{const e=t.data,s=JSON.parse(e);if(!Array.isArray(s))throw new Error("JSON root must be an array");const n=N(s);self.postMessage({type:"done",normalized:n})}catch(e){const s=e instanceof Error?e.message:"Unknown error";self.postMessage({type:"error",message:s})}}})();
